# 语义分析之语法树标注

语法树标注就是在抽象语法树上标注好符号及类型，在第6章介绍过，任何树节点实现类都定义了type变量，这个变量用来保存类型，类型可能是当前树节点定义的类型，也可能是引用其他已经定义好的类型。如果是引用其他已经定义好的类型，那么就需要在语法树标注阶段查找这个具体的类型并保存到对应树节点的type变量上。符号也是同样的道理，不过并不是任何语法树节点都能直接保存符号，也没有这个必要。为保存符号而定义的相关变量的类如表12\-1所示。 

表12\-1　可直接保存符号的树节点实现类 

![image](https://github.com/YangLuchao/img_host/raw/master/20230418/image.6nplk2gmgao0.webp)

JCCompilationUnit、JCClassDecl、JCMethodDecl与JCVariableDecl类前面已经介绍过。JCCompilationUnit类的packge变量保存包符号，如果这个包名称所对应的PackageSymbol对象已经存在，直接使用即可，如果不存在，需要创建对应的PackageSymbol对象。关于PackageSymbol对象的创建及使用，在第7章已经详细介绍过，这里不再介绍。JCClassDecl、JCMethodDecl与JCVariableDecl类会定义出新的符号，所以创建相关Symbol对象并保存到树节点实现类的相关变量上。 

对于JCNewClass、JCAssignOp、JCUnary、JCBinary、JCFieldAccess与JCIdent类来说，其Symbol类型的变量都是对已定义的符号进行引用，在第11章已经介绍过查找类型、方法及变量相关符号的一些方法，这些方法可以在标注阶段用来查找具体的符号引用。对于JCNewClass、JCAssignOp、JCUnary与JCBinary树节点实现类来说，引用的是方法，所以相关的变量保存的可能是MethodSymbol或OperatorSymbol对象，而对于JCFieldAccess与JCIdent树节点实现类来说，引用的符号可能为类型、方法与变量，所以可能为任何的Symbol对象。 

在对表达式语法树进行标注之前还需要对符号和类型进行验证，任何表达式语法树都会根据所处的上下文环境给出对符号和类型的期望，如果实际查找到的符号和类型与期望的符号和类型不兼容，Javac将报错。 
